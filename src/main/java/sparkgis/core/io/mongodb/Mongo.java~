package sparkgis.core.io.mongodb;
/* Java imports */
import java.util.Map;
import java.util.Iterator;
/* MongoDB imports */
import com.mongodb.DBObject;
import com.mongodb.BasicDBList;
import com.mongodb.BasicDBObject;
/* Local imports */
import sparkgis.SparkGISConfig;

public class Mongo
{
    /**
     * prepare mongoDB query from all keys passed in Map
     * Note: Currently only supports equality operators
     */
    public static BasicDBObject prepareQuery(final Map<String, String> params){
	BasicDBObject query = new BasicDBObject();
	// append all parameters for mongoDB query
	Iterator iterator = params.entrySet().iterator();

	boolean orFound = false;
	BasicDBList or = null;
	
	
	while(iterator.hasNext()) {
	    Map.Entry entry = (Map.Entry)iterator.next();
	    if (entry.getKey().equals("db") || entry.getKey().equals("collection"))
		continue;
	    if (entry.getKey().equals("or")){
		orFound = true;
		or = new BasicDBList();
	    }
	    
	    if (orFound){
		DBObject clause = new BasicDBObject((String)entry.getKey(), (String)entry.getValue());
		or.add(clause);
	    }
	    else
		query.append((String)entry.getKey(), (String)entry.getValue());
	}

	if (orFound){
	    //DBObject orQuery = new BasicDBObject("$or", or);
	    query.put("$or", or);
	}
	
	return query;
    }
    
    //public abstract T extractData(DBObject doc);
}
